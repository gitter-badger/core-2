<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Core by caffeina-core</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Core</h1>
        <p>Caffeina PHP Toolkit</p>
        <p class="view"><a href="https://github.com/caffeina-core/core">View the Project on GitHub <small>caffeina-core/core</small></a></p>
        <ul>
          <li><a href="https://github.com/caffeina-core/core/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/caffeina-core/core/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/caffeina-core/core">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>
<a name="core" class="anchor" href="#core"><span class="octicon octicon-link"></span></a>Core</h1>

<p>Caffeina PHP SDK</p>

<hr><h3>
<a name="installation" class="anchor" href="#installation"><span class="octicon octicon-link"></span></a>Installation</h3>

<p>Add package to your <strong>composer.json</strong>:</p>

<pre><code>{
  "require": {
    "caffeina-core/core": "*"
  }
}
</code></pre>

<p>Run composer:</p>

<pre><code>php composer.phar install -o
</code></pre>

<p>Now the entire toolchain is already available upon the vendor autoloader inclusion.</p>

<pre><code>&lt;?php
// Load vendors
include 'vendors/autoload.php';

Route::on('/',function(){
    echo "Hello from Core!";
});

// Dispatch route
Route::dispatch();

// Send response to the browser
Response::send();
</code></pre>

<hr><h1>
<a name="documentation" class="anchor" href="#documentation"><span class="octicon octicon-link"></span></a>Documentation</h1>

<hr><h1>
<a name="dictionary" class="anchor" href="#dictionary"><span class="octicon octicon-link"></span></a>Dictionary</h1>

<p>The Dictionary class defines a multi-level key value repository with dot notation keys accessors.</p>

<h3>
<a name="building-a-dictionary" class="anchor" href="#building-a-dictionary"><span class="octicon octicon-link"></span></a>Building a dictionary</h3>

<hr><p>Dictionary is a behaviour class, it must be extended by another class or the value repository will be shared.</p>

<pre><code>class Config extends Dictionary {}
</code></pre>

<h3>
<a name="setting-a-value" class="anchor" href="#setting-a-value"><span class="octicon octicon-link"></span></a>Setting a value</h3>

<hr><p>You can set a value from a key path via the <code>get</code> method.</p>

<p>A valid key path is a arbitrary deep sequence of <code>.</code> separated strings.</p>

<p><strong>Examples</strong></p>

<ul>
<li><code>test</code></li>
<li><code>alpha.beta</code></li>
<li><code>pages.section.text_block.3</code></li>
</ul><pre><code>Config::set('options.use_cache',false);

Config::set('users.whitelist',[
    'frank.ciccio',
    'walter.submarine',
    'pepen.spacca',
]);
</code></pre>

<h3>
<a name="getting-a-value" class="anchor" href="#getting-a-value"><span class="octicon octicon-link"></span></a>Getting a value</h3>

<hr><p>You can get a value from a key path via the <code>get</code> method.</p>

<pre><code>echo Config::get('users.whitelist.1'); // walter.submarine
</code></pre>

<p>You can optionally pass a default value to be returned when the requested key is not found. If a callable is passed the returned value will be used.</p>

<pre><code>print_r( Config::get('a.test',['b'=&gt;123]) ); // Array( [b] =&gt; 123 )
echo Config::get('a.test.b'); // 123
</code></pre>

<h3>
<a name="getting-all-values" class="anchor" href="#getting-all-values"><span class="octicon octicon-link"></span></a>Getting all values</h3>

<hr><p>You can get all key-values as an associative array via the <code>all</code> method.</p>

<pre><code>$all_data = Config::all();
</code></pre>

<p>Results :</p>

<pre><code>Array (
    [users] =&gt; Array (
        [whitelist] =&gt; Array(
            [0] =&gt; frank.ciccio
            [1] =&gt; walter.submarine
            [2] =&gt; pepen.spacca
        )
    )
)
</code></pre>

<h3>
<a name="clearing-the-dictionary" class="anchor" href="#clearing-the-dictionary"><span class="octicon octicon-link"></span></a>Clearing the dictionary</h3>

<hr><p>You can clear all values from a dictionary via the <code>clear</code> method.</p>

<pre><code>Config::clear();
</code></pre>

<h3>
<a name="merging-data" class="anchor" href="#merging-data"><span class="octicon octicon-link"></span></a>Merging data</h3>

<hr><p>The <code>merge</code> method extends the dictionary with values passed via an associative array. The second optional parameter will define the if merge data from right-to-left or backwise (default is false = left-to-right ).</p>

<p><strong>Setting initial data</strong></p>

<pre><code>Config::clear();
Config::merge([
    'user' =&gt; [
        'name' =&gt; 'Simon',
        'role' =&gt; 'Villain',
    ],
]);
</code></pre>

<pre><code>Array (
    [user] =&gt; Array (
            [name] =&gt; Simon
            [role] =&gt; Villain
        )
)
</code></pre>

<p><strong>Standard merge (left-to-right)</strong></p>

<pre><code>Config::merge([
    'user' =&gt; [
        'name' =&gt; 'Frank',
    ],
    'happy' =&gt; true,
]);
</code></pre>

<pre><code>Array (
    [user] =&gt; Array (
            [name] =&gt; Frank
            [role] =&gt; Villain
        )
    [happy] =&gt; 1
)
</code></pre>

<p><strong>Back merge (right-to-left)</strong></p>

<pre><code>Config::merge([
    'user' =&gt; [
        'name' =&gt; 'Frank',
    ],
    'happy' =&gt; true,
],true);
</code></pre>

<pre><code>Array (
    [user] =&gt; Array (
            [name] =&gt; Simon
            [role] =&gt; Villain
        )
    [happy] =&gt; 1
)
</code></pre>

<h1>
<a name="cache" class="anchor" href="#cache"><span class="octicon octicon-link"></span></a>Cache</h1>

<p>The Cache module allow you to handle an object persistence between requests and store heavy-computing persistent data.</p>

<h3>
<a name="retrieve-a-value" class="anchor" href="#retrieve-a-value"><span class="octicon octicon-link"></span></a>Retrieve a value</h3>

<hr><p>The simplest way to retrieve a value from cache is via the <code>get</code> method.</p>

<pre><code>$shares = Cache::get('shares');
</code></pre>

<p>You can optionally pass a default value and an expire time. The dafault value can be either a mixed or a callable. If you pass the latter it will invoked and the returned value will be used as the default value.</p>

<pre><code>$help = Cache::get('help',true);

$shares = Cache::get('shares',function(){
   return calc_user_shares();
});
</code></pre>

<p><strong>Important</strong>: When the default value is used (from a cache miss), the cache value will be setted.</p>

<pre><code>$value_generator = function(){
    return time();
};

echo Cache::get('memento',$value_generator); // (Cache MISS) returned : 1389122001 ($value_generator called)
echo Cache::get('memento',$value_generator); // (Cache HIT) returned : 1389122001
echo Cache::get('memento',$value_generator); // (Cache HIT) returned : 1389122001

</code></pre>

<h3>
<a name="setting-a-value-1" class="anchor" href="#setting-a-value-1"><span class="octicon octicon-link"></span></a>Setting a value</h3>

<hr><p>You can set a value for a key with the <code>set</code> method.</p>

<pre><code>Cache::set('friend_or_foe','friend');
</code></pre>

<p>You can pass an optional <code>expiration</code> parameter in seconds.</p>

<pre><code>Cache::set('friend_or_foe','friend',15); // Expire in 15 sec

echo Cache::get('friend_or_foe'); // friend
sleep(20);
echo Cache::get('friend_or_foe'); // (no value)

</code></pre>

<h3>
<a name="delete-a-cached-key" class="anchor" href="#delete-a-cached-key"><span class="octicon octicon-link"></span></a>Delete a cached key</h3>

<hr><p>You can delete a cached key with the <code>delete</code> method.</p>

<pre><code>Cache::delete('friend_or_foe');
</code></pre>

<h3>
<a name="flush-all-cached-keys" class="anchor" href="#flush-all-cached-keys"><span class="octicon octicon-link"></span></a>Flush all cached keys</h3>

<hr><p>You can delete all cached keys with the <code>flush</code> method.</p>

<pre><code>Cache::flush();
</code></pre>

<h3>
<a name="check-if-a-key-is-cached" class="anchor" href="#check-if-a-key-is-cached"><span class="octicon octicon-link"></span></a>Check if a key is cached</h3>

<hr><p>You can delete a cached key with the <code>exists</code> method.</p>

<pre><code>if ( Cache::exists('user_info') ) { ... }
</code></pre>

<h3>
<a name="incrementdecrement-a-value" class="anchor" href="#incrementdecrement-a-value"><span class="octicon octicon-link"></span></a>Increment/Decrement a value</h3>

<hr><p>You can increment/decrement a cached key value with the <code>inc</code> and <code>dec</code> methods.</p>

<p><strong>Example</strong></p>

<pre><code>Event::on('user.login',function(){
    Cache::inc('user.logged');
});

Event::on('user.logout',function(){
    Cache::dec('user.logged');
});

</code></pre>

<p>Default inc/dec value is 1, you can however change it by passing the increment/decrement value as the second parameter of the inc/dec methods.</p>

<pre><code>Event::on('boss.killed',function(){
    Cache::inc('user.score',1000);
});
</code></pre>

<h3>
<a name="changing-caching-strategydriver" class="anchor" href="#changing-caching-strategydriver"><span class="octicon octicon-link"></span></a>Changing caching strategy/driver</h3>

<hr><p>You can choose the Cache driver via the <code>using</code> method. The optional second parameter is dictionary of init paramenters to pass to the selected driver.</p>

<p>The default driver is <strong>Memory</strong>, a request-only persistent storage.</p>

<p><strong>Example</strong></p>

<pre><code>// Use File-based caching
Cache::using('File',[
    'cache_dir' =&gt; __DIR__ . '/cache'
]);
</code></pre>

<h1>
<a name="event" class="anchor" href="#event"><span class="octicon octicon-link"></span></a>Event</h1>

<p>The Event module allow you to bind callbacks to custom events.</p>

<h3>
<a name="attach-an-handler" class="anchor" href="#attach-an-handler"><span class="octicon octicon-link"></span></a>Attach an handler</h3>

<hr><p>You can attach an handler to a named event via the <code>on</code> method.</p>

<pre><code>Event::on('myevent',function(){
   echo 'Hello, Friend!';
});
</code></pre>

<p>Multiple handlers can be attached to the event, they will be sequentially executed when the event will be triggered.</p>

<pre><code>Event::on('my.event',function(){
   echo 'First!';
});

Event::on('my.event',function(){
   echo 'Second!';
});
</code></pre>

<p>You can attach handlers to any event name.</p>

<h3>
<a name="trigger-an-event" class="anchor" href="#trigger-an-event"><span class="octicon octicon-link"></span></a>Trigger an event</h3>

<hr><p>You can trigger an event via the <code>trigger</code> method.</p>

<pre><code>Event::trigger('my.event');
</code></pre>

<p>The <code>trigger</code> method will return an array containing the return values of all the handler attached to the event.</p>

<p><strong>Example</strong></p>

<pre><code>Event::on('my.event',function(){
   return 'Hello!';
});

Event::on('my.event',function(){
   return time();
});

$results = Event::trigger('my.event');
</code></pre>

<p>The <code>$results</code> variable contains :</p>

<pre><code>array(2) {
 [0]  =&gt;  string(6) "Hello!"
 [1]  =&gt;  int(1389115191)
}
</code></pre>

<p><code>NULL</code> will be returned if no handlers are attached to the event.</p>

<p>You can run a trigger only one time with the <code>triggerOnce</code> method.</p>

<h3>
<a name="passing-parameters-to-event-handlers" class="anchor" href="#passing-parameters-to-event-handlers"><span class="octicon octicon-link"></span></a>Passing parameters to event handlers</h3>

<hr><p>You can pass a variable number of parameter to event handlers appending them after the event name in the <code>trigger</code> method.</p>

<pre><code>Event::on('eat',function($who,$what,$where){
   echo "$who ate a $what, in the $where.";
});

Event::trigger('eat','Simon','Burrito','Kitchen');

// Result : Simon ate a Burrito, in the Kitchen

</code></pre>

<h1>
<a name="filters" class="anchor" href="#filters"><span class="octicon octicon-link"></span></a>Filters</h1>

<p>The Filters module allow you to permit user overrides to certain values.</p>

<h3>
<a name="adding-a-filter" class="anchor" href="#adding-a-filter"><span class="octicon octicon-link"></span></a>Adding a filter</h3>

<hr><p>You can attach a filter function to a custom named group via the <code>add</code> method.</p>

<pre><code>Filter::add('title',function($title){
   return strtoupper($title);
});

</code></pre>

<p>Multiple calls to the same group attach multiple filter functions.</p>

<h3>
<a name="removing-a-filter" class="anchor" href="#removing-a-filter"><span class="octicon octicon-link"></span></a>Removing a filter</h3>

<hr><p>You can remove an attached filter function to a custom named group via the <code>remove</code> method.</p>

<pre><code>$the_filter = function($title){
   return strtoupper($title);
};

Filter::add('title',$the_filter);

...

Filter::remove('title',$the_filter);

</code></pre>

<p>You can remove all filters attached to a group by not passing the filter function.</p>

<pre><code>Filter::remove('title');

</code></pre>

<h3>
<a name="applying-a-filter" class="anchor" href="#applying-a-filter"><span class="octicon octicon-link"></span></a>Applying a filter</h3>

<hr><p>You can apply a filter to a value via the <code>with</code> method.</p>

<pre><code>Filter::with('title','This was a triumph')
</code></pre>

<p><strong>Example</strong></p>

<pre><code>Filter::add('title',function($title){
   return strtoupper($title);
});

Filter::add('title',function($title){
   return $title . '!';
});

echo Filter::with('title','This was a triumph');

// THIS WAS A TRIUMPH!

</code></pre>

<h1>
<a name="route" class="anchor" href="#route"><span class="octicon octicon-link"></span></a>Route</h1>

<p>The Route module allow you to bind callbacks to HTTP requests.</p>

<h3>
<a name="url-mapping" class="anchor" href="#url-mapping"><span class="octicon octicon-link"></span></a>URL mapping</h3>

<hr><p>You can define a route via the <code>on</code> method.</p>

<pre><code>Route::on('/hello',function(){
   echo 'Hello, Friend!';
});
</code></pre>

<p>This is the simplest form to define an <code>HTTP GET</code> route responding on URL <code>/hello</code>.
You can map the same route to multiple request methods using the fluent api interface.</p>

<pre><code>Route::on('/hello')
-&gt;via(['get','post'])
-&gt;with(function(){
   echo 'Hello, Friend!';
});
</code></pre>

<p>The <code>via</code> method accepts an array of string for handled HTTP request methods.</p>

<p>The <code>with</code> method binds a callable function to the route.</p>

<p>If you need to map various HTTP methods to different callbacks for a single URL <em>(like exposing a resource via a REST API)</em> the <code>map</code> method allows you to pass a <code>method</code> =&gt; <code>callback</code> dictionary.</p>

<pre><code>Route::map('/entity(/:id)/?',[
    'get' =&gt; function($id=null){
        // READ: fetch the $id element or all if $id === null
    },
    'post' =&gt; function($id=null){
        // CREATE: build a new element
    },
    'put' =&gt; function($id=null){
        // UPDATE: modify $id element's properties
    },
    'delete' =&gt; function($id=null){
        // DELETE: delete $id element
    },
])
</code></pre>

<h3>
<a name="url-pattern-matching-and-parameters-extraction" class="anchor" href="#url-pattern-matching-and-parameters-extraction"><span class="octicon octicon-link"></span></a>URL pattern matching and parameters extraction</h3>

<hr><p>The route pattern is essentially a Regular Expression with some slight differencies.</p>

<p>The pattern is <strong>ALWAYS</strong> matched against the <strong>end</strong> of the <code>REQUEST_URI</code> parameter (stripped of the query string).</p>

<p><strong>Rules:</strong></p>

<ul>
<li>every <code>(...)</code> group becomes optional</li>
<li>you can extract parameters via <code>:named_parameter</code>
</li>
<li>the pattern can't contain the <code>#</code> character</li>
</ul><p><strong>Examples:</strong></p>

<pre><code>Route::on('/element(/:id)/?',function($id=null){
    if (null === $id){
        $result = get_all_elements();
    } else {
        $result = get_element_by_id($id);
    }
    print_r($result);
});
</code></pre>

<p>In this example the optional (is in a <code>(...)</code> group) <code>:id</code> is extracted when present, and the route can be optionally terminated by a <code>/</code>.</p>

<p>This route handles all of these request:</p>

<ul>
<li><code>/element</code></li>
<li><code>/element/</code></li>
<li><code>/element/123</code></li>
<li><code>/element/123/</code></li>
<li><code>/element/1919191</code></li>
<li><code>/element/462635</code></li>
<li>etc..</li>
</ul><p>But, as you can see, this example handles also <code>/element/fooo</code>.
If we want to give format rules to an extracted parameters we can use the <code>rules</code> method.</p>

<p>The <code>rules</code> method accepts a <code>named_parameter</code> =&gt; <code>regex</code> dictionary.</p>

<p><code>rules([ 'parameter_name' =&gt; 'parameter_regex_pattern' ])</code></p>

<p>We can strenghten the former example adding rules to the <code>id</code> parameter for accepting only integer values <em>(defined by the \d+ regex pattern)</em>.</p>

<p><strong>Example:</strong></p>

<pre><code>Route::on('/element(/:id)/?',function($id=null){
    if (null === $id){
        $result = get_all_elements();
    } else {
        $result = get_element_by_id($id);
    }
    print_r($result);
})
-&gt;rules([ 'id' =&gt; '\d+' ]);
</code></pre>

<h3>
<a name="route-groups" class="anchor" href="#route-groups"><span class="octicon octicon-link"></span></a>Route groups</h3>

<hr><p>You can encapsulate routes based on a prefix pattern.
If the current request doesn't match the group URL pattern, relative routes definition are <strong>not</strong> registered.</p>

<p>This feature can be used for response-time optimization and for mounting route trees to a dynamic URL prefix.</p>

<p><strong>Examples:</strong></p>

<p>*** Admin section ***</p>

<pre><code>Route::group('/admin',function(){

    Route::on('/',function(){
        echo "Admin Index";
    });

    Route::on('/login')
    -&gt;via(['get','post'])
    -&gt;with(function(){
        // Handle login
    });

    Route::on('/logout',function(){
       // handle logout
    });

});
</code></pre>

<p>*** CRUD controller ***</p>

<pre><code>function generate_CRUD_controller_for($element_name){
    Route::group('/'.$element_name,function() use ($element_name) {
        Route::map('(/:id)',[
            'get' =&gt; function($id=null){
                // READ: fetch the $id element or all if $id === null
            },
            'post' =&gt; function($id=null){
                // CREATE: build a new element
            },
            'put' =&gt; function($id=null){
                // UPDATE: modify $id element's properties
            },
            'delete' =&gt; function($id=null){
                // DELETE: delete $id element
            },
        ])  
    });
}

// Expose CRUD API for user, job and skill resources
generate_CRUD_controller_for('user');
generate_CRUD_controller_for('job');
generate_CRUD_controller_for('skill');


</code></pre>

<h1>
<a name="shell" class="anchor" href="#shell"><span class="octicon octicon-link"></span></a>Shell</h1>

<p>The Shell class can be used to execute OS commands.</p>

<h3>
<a name="executing-a-command" class="anchor" href="#executing-a-command"><span class="octicon octicon-link"></span></a>Executing a command</h3>

<hr><p>The Shell class permits the invocation of shell commands via dynamic static methods.</p>

<p><strong>Examples :</strong></p>

<p>Run the <code>cal</code> command :</p>

<pre><code>echo Shell::cal();
</code></pre>

<p>This outputs :</p>

<pre><code>    Agosto 2014
Do Lu Ma Me Gi Ve Sa
                1  2
 3  4  5  6  7  8  9
10 11 12 13 14 15 16
17 18 19 20 21 22 23
24 25 26 27 28 29 30
31
</code></pre>

<h4>
<a name="passing-a-string" class="anchor" href="#passing-a-string"><span class="octicon octicon-link"></span></a>Passing a string</h4>

<p>You can send multiple arguments to the command by passing parameters to the method.</p>

<pre><code>echo Shell::ls('-la ./');

// or

echo Shell::ls('-la', './');
</code></pre>

<h4>
<a name="passing-an-array" class="anchor" href="#passing-an-array"><span class="octicon octicon-link"></span></a>Passing an array</h4>

<p>If an array is passed as an argument it will be interpreted as an options map :</p>

<pre><code>echo Shell::example_command([
    'silent',
    'username' =&gt; 'Gordon Freeman',
    'debug' =&gt; false,
    'profile' =&gt; true,
],'other commands');
</code></pre>

<p>Compiles to : <code>/usr/bin/env example_command --silent --username='Gordon Freeman' --profile other commands</code></p>

<h4>
<a name="passing-a-shell-object" class="anchor" href="#passing-a-shell-object"><span class="octicon octicon-link"></span></a>Passing a Shell object</h4>

<p>If a Shell object is passed as an argument it will be compiled ad a direct evaluation subcommand :</p>

<pre><code>Shell::pipe(
    Shell::cal(),
    Shell::grep(Shell::date('+%d'))
);
</code></pre>

<p>Compiles to : <code>cal | /usr/bin/env grep $(/usr/bin/env date +%d)</code></p>

<h4>
<a name="lazy-execution" class="anchor" href="#lazy-execution"><span class="octicon octicon-link"></span></a>Lazy Execution</h4>

<p>Shell command are not invoked immediately, but only on result evaluation (lazy invocation). You can store the prepared command in a variable for multiple use.</p>

<p>To invoke the command you must force the evaluation to string or call the <code>run</code> method;</p>

<pre><code>// Not executed.
$command = Shell::cal();

// Not executed.
$command;

// Not executed.
!$command;

// Executed.
$command-&gt;run();

// Executed.
(string)$command;

// Executed.
$x = $command . '';
</code></pre>

<h3>
<a name="get-the-compiled-shell-command" class="anchor" href="#get-the-compiled-shell-command"><span class="octicon octicon-link"></span></a>Get the compiled shell command</h3>

<hr><p>You can retrieve the compiled shell command via the <code>getShellCommand</code> method.</p>

<pre><code>echo Shell::sed('-e','"s/^ *//"','-e','"s/ *$//"')-&gt;getShellCommand();
</code></pre>

<p>Returns:</p>

<pre><code>/usr/bin/env sed -e "s/^ *//" -e "s/ *$//"
</code></pre>

<h3>
<a name="command-piping" class="anchor" href="#command-piping"><span class="octicon octicon-link"></span></a>Command piping</h3>

<hr><p>If you want to concatenate multiple commands in a pipeline you must use the <code>pipe</code> method.</p>

<pre><code>echo Shell::pipe(
  Shell::cal(),
  Shell::grep('-E','"\d{4}"'),
  Shell::sed('-e','"s/^ *//"','-e','"s/ *$//"')
);
</code></pre>

<p>The compiled command is :</p>

<pre><code>cal | /usr/bin/env grep -E "\d{4}" | /usr/bin/env sed -e "s/^ *//" -e "s/ *$//"
</code></pre>

<p>The output :</p>

<pre><code>August 2014
</code></pre>

<h3>
<a name="command-sequencing" class="anchor" href="#command-sequencing"><span class="octicon octicon-link"></span></a>Command sequencing</h3>

<hr><p>Similar to command piping you can concatenate multiple shell commands via logical implication ( &amp;&amp; ) using the <code>sequence</code> method.</p>

<pre><code>echo Shell::sequence(
  Shell::nginx('-t'),
  Shell::nginx('-s reload')
);
</code></pre>

<p>The compiled command is :</p>

<pre><code>/usr/bin/env nginx -t &amp;&amp; /usr/bin/env nginx -s reload
</code></pre>

<h3>
<a name="command-aliases" class="anchor" href="#command-aliases"><span class="octicon octicon-link"></span></a>Command aliases</h3>

<hr><p>You can create an alias to a complex or dynamic shell command via the <code>alias</code> method.</p>

<pre><code>Shell::alias('trim',function(){
    return Shell::sed('-e','"s/^ *//"','-e','"s/ *$//"');
});
</code></pre>

<p>Now you can use the alias <code>trim</code> as if it was a real command, when invoked the the callback will be called and the resulting Shell object (or raw command if you return a string) will be used in place of the alias.</p>

<p><strong>Example:</strong></p>

<pre><code>echo Shell::pipe(
  Shell::cal(),
  Shell::grep('-E','"\d{4}"'),
  Shell::trim()
);
</code></pre>

<p>Compiles as : <code>cal | /usr/bin/env grep -E "\d{4}" | /usr/bin/env sed -e "s/^ *//" -e "s/ *$//"</code></p>

<p>Another example are some git aliases for an easy deploy system:</p>

<pre><code>Shell::alias('gitCommit',function($commit_message = 'Save'){
    return Shell::sequence(
        Shell::git('add -A'),
        Shell::git('commit -am',Shell::escape($commit_message))
    );
});

Shell::alias('gitCommitAndPush',function($commit_message = 'Save'){
    return Shell::sequence(
        Shell::gitCommit($commit_message),
        Shell::git('pull'),
        Shell::git('push')
    );
});
</code></pre>

<p>Now you can "save" your work with : <code>Shell::gitCommit()</code> or with a commit message <code>Shell::gitCommit("Latest fixes.")</code>;</p>

<h1>
<a name="sql" class="anchor" href="#sql"><span class="octicon octicon-link"></span></a>SQL</h1>

<p>The SQL module expose a shorthand for common database methods extending the PDO layer.</p>

<h3>
<a name="bind-to-database" class="anchor" href="#bind-to-database"><span class="octicon octicon-link"></span></a>Bind to database</h3>

<hr><p>You can bind the SQL module to a database with a DSN (Data Source Name) string via the <code>connect</code> method.
Connection is lazy-loaded at the first database access.</p>

<pre><code>SQL::connect('mysql:host=localhost;dbname=test','root','password');
</code></pre>

<h3>
<a name="execute-a-sql-statement" class="anchor" href="#execute-a-sql-statement"><span class="octicon octicon-link"></span></a>Execute a SQL statement</h3>

<hr><p>You can execute a SQL statement with the <code>exec</code> method. The query will be prepared and you can pass optional binding parameters as last function argument.</p>

<pre><code>SQL::exec('TRUNCATE TABLE `users`');

SQL::exec('DELETE FROM `users` WHERE `age` &lt; 16');
</code></pre>

<h3>
<a name="retrieve-a-single-value" class="anchor" href="#retrieve-a-single-value"><span class="octicon octicon-link"></span></a>Retrieve a single value</h3>

<hr><p>The <code>value</code> method executes the query, with the optional parameters and returns the first column of the first row of the results.</p>

<pre><code>$total_users = SQL::value('SELECT COUNT(1) FROM `users`');

$user_is_registered = !!SQL::value('SELECT 1 FROM `users` WHERE username = :usr_name',[
  'usr_name' =&gt; $username
]);
</code></pre>

<h3>
<a name="retrieve-rows" class="anchor" href="#retrieve-rows"><span class="octicon octicon-link"></span></a>Retrieve rows</h3>

<hr><p>The <code>each</code> method executes the query, with the optional parameters and runs the passed callback with the current row object for every row of the results.</p>

<pre><code>SQL::each('SELECT * FROM `users`',function($user){
  echo '&lt;li&gt;&lt;a href="mailto:', $user-&gt;email ,'"&gt;', $user-&gt;name ,'&lt;/a&gt;&lt;/li&gt;';
});
</code></pre>

<h3>
<a name="retrieve-all-results" class="anchor" href="#retrieve-all-results"><span class="octicon octicon-link"></span></a>Retrieve all results</h3>

<hr><p>The <code>all</code> method is used to retrieve all results in a single call.</p>

<pre><code>echo json_encode( SQL::all('SELECT `name` , `email` FROM `users`') );
</code></pre>

<h3>
<a name="insert-a-new-row" class="anchor" href="#insert-a-new-row"><span class="octicon octicon-link"></span></a>Insert a new row</h3>

<hr><p>The <code>insert</code> method is used to insert into a defined table a new row, passed as an associative array.</p>

<pre><code>$inserted_item_id = SQL::insert('users',[
  'name'     =&gt; 'Stannis Baratheon',
  'password' =&gt; 'im_the_one_true_king',
]);
</code></pre>

<h3>
<a name="update-a-single-row" class="anchor" href="#update-a-single-row"><span class="octicon octicon-link"></span></a>Update a single row</h3>

<hr><p>The <code>update</code> method is used to change a single row data, passed as an associative array.</p>

<pre><code>SQL::update('users',[
  'id'       =&gt; 321,
  'name'     =&gt; 'King Stannis Baratheon',
]);
</code></pre>

<p>You can also override the name of the primary key column as the third function parameter, default is <code>id</code></p>

<pre><code>SQL::update('users',[
  'email'    =&gt; 'stannis@baratheon.com',
  'name'     =&gt; 'King Stannis Baratheon',
],'email');
</code></pre>

<h3>
<a name="delete-a-single-row" class="anchor" href="#delete-a-single-row"><span class="octicon octicon-link"></span></a>Delete a single row</h3>

<hr><p>The <code>update</code> method is used to change a single row data, passed as an associative array.</p>

<pre><code>SQL::update('users',[
  'id'       =&gt; 321,
  'name'     =&gt; 'King Stannis Baratheon',
]);
</code></pre>
      </section>
    </div>
    <footer>
      <p>Project maintained by <a href="https://github.com/caffeina-core">caffeina-core</a></p>
      <p>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></p>
    </footer>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-26094283-19");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>